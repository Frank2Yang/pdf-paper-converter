# 🚀 GitHub + Vercel 完整部署指南

## 📋 概述

本指南将详细指导您如何使用 GitHub + Vercel 部署 MinerU PDF 智能解析器，实现自动化部署和全球 CDN 加速。

## 🎯 部署优势

- ⚡ **自动部署**: GitHub 推送自动触发 Vercel 部署
- 🌐 **全球 CDN**: Vercel 提供的全球加速访问
- 🔒 **HTTPS 加密**: 自动 SSL 证书配置
- 📊 **实时监控**: 内置性能和错误监控
- 💰 **免费额度**: Vercel 提供慷慨的免费使用额度

## 🚀 快速部署（5分钟）

### 第一步：准备 GitHub 仓库

1. **Fork 本仓库**
   - 点击右上角 "Fork" 按钮
   - 选择您的 GitHub 账号
   - 等待 Fork 完成

2. **克隆到本地（可选）**
   ```bash
   git clone https://github.com/your-username/mineru-pdf-parser.git
   cd mineru-pdf-parser
   ```

### 第二步：连接 Vercel

1. **注册 Vercel 账号**
   - 访问 [vercel.com](https://vercel.com)
   - 使用 GitHub 账号登录

2. **创建新项目**
   - 点击 "New Project"
   - 选择您 Fork 的仓库
   - 点击 "Import"

3. **配置项目**
   - 项目名称：`mineru-pdf-parser`
   - 框架预设：`Other`
   - 根目录：`./`
   - 构建命令：留空
   - 输出目录：留空

4. **部署项目**
   - 点击 "Deploy"
   - 等待部署完成（约 2-3 分钟）

### 第三步：配置环境变量

在 Vercel 项目设置中添加环境变量：

1. **进入项目设置**
   - 在 Vercel 控制台中选择您的项目
   - 点击 "Settings" 标签
   - 选择 "Environment Variables"

2. **添加环境变量**
   ```bash
   # 基础配置
   STREAMLIT_SERVER_HEADLESS=true
   STREAMLIT_BROWSER_GATHER_USAGE_STATS=false
   HF_ENDPOINT=https://hf-mirror.com
   
   # 可选配置
   MINERU_API_URL=https://your-api-server.com
   ```

### 第四步：访问应用

部署完成后，您将获得：
- **预览地址**: `https://your-project-name.vercel.app`
- **生产地址**: `https://your-project-name-git-main-your-username.vercel.app`

## 🔧 高级配置

### 自定义域名

1. **添加域名**
   - 在 Vercel 项目设置中选择 "Domains"
   - 输入您的域名（如：`pdf.your-domain.com`）
   - 点击 "Add"

2. **配置 DNS**
   - 在您的域名提供商处添加 CNAME 记录
   - 指向 `cname.vercel-dns.com`

3. **SSL 证书**
   - Vercel 自动配置 SSL 证书
   - 支持 HTTPS 访问

### GitHub Actions 配置

1. **设置 Secrets**
   在 GitHub 仓库设置中添加：
   ```bash
   VERCEL_TOKEN=your-vercel-token
   VERCEL_ORG_ID=your-org-id
   VERCEL_PROJECT_ID=your-project-id
   ```

2. **获取 Vercel Token**
   - 访问 [Vercel Settings](https://vercel.com/account/tokens)
   - 创建新的 Token
   - 复制 Token 值

3. **获取项目 ID**
   ```bash
   # 在项目根目录运行
   npx vercel link
   cat .vercel/project.json
   ```

### 性能优化

1. **函数配置**
   在 `vercel.json` 中调整：
   ```json
   {
     "functions": {
       "app.py": {
         "maxDuration": 300,
         "memory": 3008
       }
     }
   }
   ```

2. **区域配置**
   ```json
   {
     "regions": ["hkg1", "sin1", "sfo1"]
   }
   ```

## 🛠️ 本地开发

### 环境要求

- Python 3.8+
- Node.js 16+ (用于 Vercel CLI)
- Git

### 安装步骤

1. **克隆仓库**
   ```bash
   git clone https://github.com/your-username/mineru-pdf-parser.git
   cd mineru-pdf-parser
   ```

2. **安装 Python 依赖**
   ```bash
   pip install -r requirements.txt
   ```

3. **安装 Vercel CLI**
   ```bash
   npm install -g vercel
   ```

4. **本地开发**
   ```bash
   # 使用 Streamlit
   streamlit run app.py
   
   # 或使用 Vercel Dev
   vercel dev
   ```

### 本地测试

```bash
# 启动应用
streamlit run app.py

# 访问地址
open http://localhost:8501
```

## 🔄 自动部署流程

### 部署触发

- **推送到 main 分支**: 自动部署到生产环境
- **推送到其他分支**: 创建预览部署
- **Pull Request**: 创建预览部署

### 部署流程

```
GitHub Push → GitHub Actions → Vercel Build → Live Deployment
     ↓              ↓              ↓              ↓
   代码检查      语法验证        构建应用        上线服务
```

### 回滚机制

1. **自动回滚**
   - 构建失败时自动回滚到上一个稳定版本

2. **手动回滚**
   ```bash
   # 使用 Vercel CLI
   vercel rollback
   
   # 或在 Vercel 控制台操作
   ```

## 📊 监控和维护

### 性能监控

1. **Vercel Analytics**
   - 访问量统计
   - 性能指标
   - 错误追踪

2. **实时日志**
   ```bash
   # 查看实时日志
   vercel logs
   
   # 查看特定部署日志
   vercel logs --follow
   ```

### 错误处理

1. **错误追踪**
   - Vercel 自动捕获运行时错误
   - 在控制台查看错误详情

2. **调试模式**
   ```bash
   # 本地调试
   vercel dev --debug
   ```

## 🔒 安全配置

### 环境变量安全

- 敏感信息存储在 Vercel 环境变量中
- 不在代码中硬编码密钥
- 使用不同环境的不同配置

### 访问控制

1. **密码保护**
   ```python
   # 在 app.py 中添加
   import streamlit as st
   
   def check_password():
       def password_entered():
           if st.session_state["password"] == "your-password":
               st.session_state["password_correct"] = True
               del st.session_state["password"]
           else:
               st.session_state["password_correct"] = False
   
       if "password_correct" not in st.session_state:
           st.text_input("密码", type="password", on_change=password_entered, key="password")
           return False
       elif not st.session_state["password_correct"]:
           st.text_input("密码", type="password", on_change=password_entered, key="password")
           st.error("密码错误")
           return False
       else:
           return True
   
   if not check_password():
       st.stop()
   ```

## 🆙 更新和维护

### 代码更新

```bash
# 1. 拉取最新代码
git pull origin main

# 2. 修改代码
# ... 进行您的修改

# 3. 提交更改
git add .
git commit -m "更新功能"
git push origin main

# 4. 自动触发部署
```

### 依赖更新

```bash
# 更新 Python 依赖
pip install --upgrade -r requirements.txt
pip freeze > requirements.txt

# 提交更新
git add requirements.txt
git commit -m "更新依赖"
git push origin main
```

## 🎯 最佳实践

### 开发流程

1. **功能分支开发**
   ```bash
   git checkout -b feature/new-feature
   # 开发新功能
   git push origin feature/new-feature
   # 创建 Pull Request
   ```

2. **代码审查**
   - 使用 Pull Request 进行代码审查
   - 自动运行测试和检查

3. **渐进式部署**
   - 先部署到预览环境
   - 测试通过后合并到 main 分支

### 性能优化

1. **代码优化**
   - 使用缓存减少重复计算
   - 优化文件处理流程
   - 减少依赖包大小

2. **资源管理**
   - 及时清理临时文件
   - 控制内存使用
   - 优化函数执行时间

## 📞 技术支持

### 常见问题

1. **部署失败**
   - 检查 `vercel.json` 配置
   - 查看构建日志
   - 验证依赖是否正确

2. **函数超时**
   - 增加 `maxDuration` 设置
   - 优化代码性能
   - 考虑分步处理

3. **内存不足**
   - 增加 `memory` 设置
   - 优化内存使用
   - 使用流式处理

### 获取帮助

- 📖 **Vercel 文档**: [vercel.com/docs](https://vercel.com/docs)
- 🐛 **问题报告**: [GitHub Issues](https://github.com/your-repo/issues)
- 💬 **社区支持**: [Vercel Discord](https://discord.gg/vercel)

---

**🎉 恭喜！您已成功掌握 GitHub + Vercel 部署方案！**
